sudo: required
language: python
services:
  - docker
python:
  - '3.6'
before_script:
  - docker-compose build
script:
  - docker-compose run --rm web bash -c "flake8 . &&
                                         python wait_for_postgres.py &&
                                         python manage.py test"

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_SECURE_ENV_VARS" == "true" ] ;
    then docker login -u _ -p $HEROKU_AUTH_TOKEN registry.heroku.com; docker tag web
    registry.heroku.com/ramble-prod/web; docker push registry.heroku.com/ramble-prod/web;
    fi
notifications:
  email: false
cache:
  pip: true
env:
  global:
    secure: gEZkHILUl4m+6br34R7+Bg3qhYk5zAMn9qSFbilmrAVUC9Sa8WsGTZIVnxMyzVN5appPSuT8zeGKxkCcjT4hHjh6wM3+rFQTp81ICHCAfY/WjGo51I6hcNpOApFQlfa+mBVHBXqGBUWams9atyIfprOEoQVkriS6NKvgm8hDmF8YHZq0AheIAZcSKSYc8Zme/IEnEB1OF8lBnXHRtRd6A6wb6WzbrVdmJSIc/6tmS4G7qNjiAZLMVP33JeM16naWJB9gCbHQeqMpXu07I0Lj4Y/p4OkxPSdlkJ+irxgRgS7Rcksi+fHopoV6VfBHGDGKikVXExxS6UZaj0WRwGe1uFp/UGrFU4+EQJk1pUS89aWBxDWeWn8iDIFJtwU3A59RsaoNo6BRO5/kIr+An2gpKrpH0b+qXgc4cDNiKX0yj1vTmQ0UCOlRhxGDDCbxGtnuOHA10YElCt9Q2Kf2yY1GI74J9E+CQG8fkl4kYplFxVfwyonFILy/9o6kXc9qJH+/r/blFGZQWLh+81MtZ26qbFrBMcZjYgtaG/TK3BaokTfjOBQyZUe3vsZWQGw/BRntoni/dN2ihCSBn46AjMc/G/HAxEtBCuzWpLbKbtS6xRAtnaDvdemSDYLCzFtbcTnpG8tYf0oAiwHjoxrv/ftyrIKnJqnV4m2aQ57MvpRcJOs=
